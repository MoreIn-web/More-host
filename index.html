<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MOrehost IDE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs/loader.js"></script>
  <style>
    #loader {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      z-index: 50;
    }
    #loader.hidden {
      display: none;
    }
  </style>
</head>
<body class="h-screen w-screen overflow-hidden bg-gray-50">
  <!-- Loading Screen -->
  <div id="loader">
    <div class="text-center">
      <div class="animate-spin h-12 w-12 border-4 border-gray-300 border-t-gray-900 rounded-full mx-auto"></div>
      <p class="mt-4 font-semibold text-gray-700">Loading MOrehost...</p>
    </div>
  </div>

  <!-- Start Screen -->
  <div id="startScreen" class="h-full flex items-center justify-center">
    <button id="newProjectBtn" class="px-6 py-3 rounded-xl bg-gray-900 text-white text-lg font-bold shadow">New Project</button>
  </div>

  <!-- Main Workspace -->
  <div id="workspace" class="hidden flex flex-col h-full">
    <!-- Top bar -->
    <div class="flex items-center justify-between px-4 py-2 bg-white border-b">
      <div class="font-bold text-xl">MOrehost</div>
      <div class="flex gap-2">
        <button id="addFileBtn" class="px-3 py-1 rounded-lg bg-gray-200">Add File</button>
        <button id="runBtn" class="px-3 py-1 rounded-lg bg-green-500 text-white">Run</button>
        <button id="previewBtn" class="px-3 py-1 rounded-lg bg-blue-500 text-white">Preview</button>
      </div>
    </div>
    <!-- File tabs -->
    <div id="fileTabs" class="flex gap-2 px-4 py-2 bg-gray-100 border-b text-sm overflow-x-auto"></div>
    <!-- Editor -->
    <div id="editor" class="flex-1"></div>
    <!-- Console -->
    <div id="console" class="h-40 bg-black text-white text-sm p-2 overflow-auto hidden"></div>
    <!-- Preview -->
    <iframe id="preview" class="hidden flex-1 border-t"></iframe>
  </div>

<script>
  // Loading screen hide after load
  window.addEventListener('load', () => {
    document.getElementById('loader').classList.add('hidden');
  });

  // Project state
  let currentProject = null;
  let files = {};
  let currentFile = null;
  let editorInstance;

  const startScreen = document.getElementById('startScreen');
  const workspace = document.getElementById('workspace');
  const newProjectBtn = document.getElementById('newProjectBtn');
  const addFileBtn = document.getElementById('addFileBtn');
  const fileTabs = document.getElementById('fileTabs');
  const runBtn = document.getElementById('runBtn');
  const consoleEl = document.getElementById('console');
  const previewBtn = document.getElementById('previewBtn');
  const previewEl = document.getElementById('preview');

  // Monaco loader config
  require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs' } });
  require(["vs/editor/editor.main"], function () {
    editorInstance = monaco.editor.create(document.getElementById('editor'), {
      value: "",
      language: "javascript",
      theme: "vs-dark",
      automaticLayout: true
    });
  });

  // New Project
  newProjectBtn.onclick = () => {
    const name = prompt("Enter project name:");
    if (!name) return alert("Project name required!");
    currentProject = name;
    startScreen.classList.add('hidden');
    workspace.classList.remove('hidden');
  };

  // Add File
  addFileBtn.onclick = () => {
    const name = prompt("Enter file name (with extension):");
    if (!name) return alert("File name required!");
    if (files[name]) return alert("File already exists!");
    files[name] = "";
    selectFile(name);
    renderTabs();
  };

  function renderTabs() {
    fileTabs.innerHTML = "";
    Object.keys(files).forEach(fname => {
      const tab = document.createElement('button');
      tab.className = `px-2 py-1 rounded ${fname === currentFile ? 'bg-white border' : 'bg-gray-200'}`;
      tab.innerText = fname;
      tab.onclick = () => selectFile(fname);
      fileTabs.appendChild(tab);
    });
  }

  function selectFile(name) {
    if (currentFile) {
      files[currentFile] = editorInstance.getValue();
    }
    currentFile = name;
    editorInstance.setValue(files[name]);
    const ext = name.split('.').pop();
    let lang = 'javascript';
    if (ext === 'html') lang = 'html';
    else if (ext === 'css') lang = 'css';
    else if (ext === 'md') lang = 'markdown';
    monaco.editor.setModelLanguage(editorInstance.getModel(), lang);
    renderTabs();
  }

  // Run JS
  runBtn.onclick = () => {
    if (!currentFile) return alert("No file selected!");
    files[currentFile] = editorInstance.getValue();
    const ext = currentFile.split('.').pop();
    consoleEl.classList.remove('hidden');
    previewEl.classList.add('hidden');
    consoleEl.innerText = "";
    if (ext === 'js') {
      try {
        const output = eval(files[currentFile]);
        if (output !== undefined) consoleEl.innerText += output + "\n";
      } catch (e) {
        consoleEl.innerText += e + "\n";
      }
    } else {
      consoleEl.innerText = "Run only works for .js files. Use Preview for HTML/CSS/JS";
    }
  };

  // Preview Project
  previewBtn.onclick = () => {
    consoleEl.classList.add('hidden');
    previewEl.classList.remove('hidden');
    let html = files['index.html'] || "<h1>No index.html found</h1>";
    let css = files['style.css'] ? `<style>${files['style.css']}</style>` : "";
    let js = files['script.js'] ? `<script>${files['script.js']}<\/script>` : "";
    const blob = new Blob([html + css + js], { type: 'text/html' });
    previewEl.src = URL.createObjectURL(blob);
  };
</script>
</body>
</html>
